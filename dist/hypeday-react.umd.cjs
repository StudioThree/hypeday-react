(function(r,v){typeof exports=="object"&&typeof module<"u"?module.exports=v(require("react")):typeof define=="function"&&define.amd?define(["react"],v):(r=typeof globalThis<"u"?globalThis:r||self,r.HypeDayReact=v(r.React))})(this,function(r){"use strict";const n=(e=>e&&typeof e=="object"&&"default"in e?e:{default:e})(r),R="https://apitest.hype.day";function q(e){return e.text().then(l=>{const s=l&&JSON.parse(l);if(!e.ok){const i=s&&s.message||e.statusText;return Promise.reject(i)}return s})}function k({appId:e,projectId:l,walletAddress:s}){const i={method:"GET",headers:{"Content-Type":"application/json"}};return fetch(`${R}/getProject?`+new URLSearchParams({appid:e,userid:s||"",projectid:l}),i).then(q)}function A({provider:e,appId:l,projectId:s,chain:i,walletAddress:u,returnUrl:f}){const a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appId:l,chain:i,walletAddress:u,projectId:s,returnUrl:f})};return fetch(`${R}/${e==="twitter"?"t":"d"}GetUrlForApp`,a).then(q)}function L({appId:e,projectId:l,chain:s,wallet:i,customField:u}){const f={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appId:e,chain:s,wallet:i,projectId:l,customField:u})};return fetch(`${R}/validateForAppProject`,f).then(q)}function T({title:e,rightText:l,buttonDisabled:s=!1,onClick:i,info:u,isLoading:f=!1}){return n.default.createElement("section",{className:"hypeday-section"},n.default.createElement("header",{className:"hypeday-section-header"},n.default.createElement("h3",{className:"hypeday-h3"},e),l?n.default.createElement("span",{className:"hypeday-info"},l):n.default.createElement("button",{className:"hypeday-button",onClick:i,disabled:f||s,title:s?"Please login first":void 0},f&&n.default.createElement("div",{className:"hypeday-spinner hypeday-btn-spinner"}),n.default.createElement("span",{style:{visibility:f?"hidden":"initial"}},"Connect"))),u.map((a,c)=>n.default.createElement("span",{key:c,className:"hypeday-info"},a)))}function O({projectData:e,appId:l,walletAddress:s}){var c,h,y,t;const[i,u]=r.useState(!1),f=r.useMemo(()=>{var S,E;if(!((S=e==null?void 0:e.discord)!=null&&S.enabled)&&!((E=e==null?void 0:e.discord2)!=null&&E.enabled))return[];const{discord:d,discord2:g}=e,b=[];d!=null&&d.enabled&&b.push(d),g!=null&&g.enabled&&b.push(g);const m=[];return b.forEach(o=>{var w;if(o.isServerRequired){const N=n.default.createElement(n.default.Fragment,null,"Join the"," ",n.default.createElement("a",{href:o==null?void 0:o.serverLink,target:"_blank",rel:"noreferrer"},n.default.createElement("strong",null,o==null?void 0:o.serverDisplayName))," ","server on Discord",o.isShouldJoinBeforeRequired?n.default.createElement(n.default.Fragment,null," ","before"," ",n.default.createElement("strong",null,new Date((o==null?void 0:o.shouldJoinBefore)||"").toLocaleString())):null);m.push(N)}if(o.isRoleRequired){const N=n.default.createElement(n.default.Fragment,null,'and have the "',(w=o==null?void 0:o.roleDisplayNames)==null?void 0:w.join(", "),'" role(s)');m.push(N)}}),m},[e]),a=async()=>{if(!(!l||!s||!(e!=null&&e.id)))try{u(!0);const{url:d}=await A({provider:"discord",appId:l,walletAddress:s,chain:e.chain,projectId:e.id,returnUrl:window.location.href});window.location.assign(d)}catch(d){console.error(d)}finally{u(!1)}};return!((c=e==null?void 0:e.discord)!=null&&c.enabled)&&!((h=e==null?void 0:e.discord2)!=null&&h.enabled)?null:n.default.createElement(T,{title:"Discord",onClick:a,info:f,rightText:(t=(y=e==null?void 0:e.userInfo)==null?void 0:y.discord)==null?void 0:t.username,buttonDisabled:!s,isLoading:i})}const P=n.default.forwardRef(function({projectData:l},s){var u;if(!((u=l==null?void 0:l.customfield)!=null&&u.enabled))return null;const{customfield:i}=l;return n.default.createElement("section",{className:"hypeday-section"},n.default.createElement("header",{className:"hypeday-section-header"},n.default.createElement("h3",{className:"hypeday-h3"},"Open Response")),n.default.createElement("span",{className:"hypeday-info"},i.labels[0]),n.default.createElement("input",{className:"hypeday-input",type:"text",placeholder:i.labels[0],ref:s}))});function C({dateString:e,message:l}){const[s,i]=r.useState(!1),[u,f]=r.useState(0),[a,c]=r.useState(0),[h,y]=r.useState(0),[t,d]=r.useState(0);return r.useEffect(()=>{const g=new Date(e).getTime(),b=setInterval(()=>{const m=new Date().getTime(),S=g-m,E=Math.floor(S/(1e3*60*60*24)),o=Math.floor(S%(1e3*60*60*24)/(1e3*60*60)),w=Math.floor(S%(1e3*60*60)/(1e3*60)),N=Math.floor(S%(1e3*60)/1e3);if(S<=0){clearInterval(b),i(!0),f(0),c(0),y(0),d(0);return}f(E),c(o),y(w),d(N)},1e3);return()=>clearInterval(b)},[e]),!s&&!u&&!a&&!h&&!t?n.default.createElement("span",{style:{visibility:"hidden"}},"Calculating.."):s?n.default.createElement(n.default.Fragment,null,l):n.default.createElement(n.default.Fragment,null,u>0&&`${u} days, `,a>0&&`${a} hours, `,h>0&&`${h} minutes, `,t>0&&`${t} seconds`)}function F({children:e,title:l}){return n.default.createElement("section",{className:"hypeday-section"},n.default.createElement("header",{className:"hypeday-section-header"},n.default.createElement("h3",{className:"hypeday-h3"},l)),n.default.createElement("span",{className:"hypeday-info"},e))}function H({projectData:e}){var u,f,a,c,h,y,t,d,g,b,m,S;const[l,s]=r.useState(),i=((u=e==null?void 0:e.signupAccess)==null?void 0:u.isEndDateRequired)&&((f=e==null?void 0:e.signupAccess)==null?void 0:f.endDate)&&new Date((a=e==null?void 0:e.signupAccess)==null?void 0:a.endDate).getTime()<Date.now();return r.useEffect(()=>{var E,o,w,N;(E=e==null?void 0:e.signupAccess)!=null&&E.isStartDateRequired&&s(!!(((o=e==null?void 0:e.signupAccess)==null?void 0:o.isStartDateRequired)&&((w=e==null?void 0:e.signupAccess)==null?void 0:w.startDate)&&new Date((N=e==null?void 0:e.signupAccess)==null?void 0:N.startDate).getTime()>Date.now()))},[e]),r.useEffect(()=>{var E,o;if(l&&((E=e==null?void 0:e.signupAccess)==null?void 0:E.startDate)){const w=setTimeout(()=>s(!1),new Date((o=e==null?void 0:e.signupAccess)==null?void 0:o.startDate).getTime()-Date.now());return()=>clearTimeout(w)}},[l,(c=e==null?void 0:e.signupAccess)==null?void 0:c.startDate]),i&&((h=e.signupAccess)==null?void 0:h.endDate)?n.default.createElement(F,{title:"Registration is closed"},"Registration is closed on"," ",(t=new Date((y=e.signupAccess)==null?void 0:y.endDate))==null?void 0:t.toUTCString(),". Thank you for your interest."):l&&((d=e==null?void 0:e.signupAccess)==null?void 0:d.startDate)?n.default.createElement(F,{title:"Registration starts in:"},n.default.createElement(C,{dateString:(g=e==null?void 0:e.signupAccess)==null?void 0:g.startDate,message:"Registration is open."})):!i&&!l&&((b=e==null?void 0:e.signupAccess)==null?void 0:b.isEndDateRequired)&&((m=e==null?void 0:e.signupAccess)==null?void 0:m.endDate)?n.default.createElement(F,{title:"Registration ends in:"},n.default.createElement(C,{dateString:(S=e==null?void 0:e.signupAccess)==null?void 0:S.endDate,message:"Registration is closed."})):null}function M({projectData:e,appId:l,walletAddress:s}){var c,h,y;const[i,u]=r.useState(!1),f=r.useMemo(()=>{var g,b;if(!((g=e==null?void 0:e.twitter)!=null&&g.enabled))return[];const{twitter:t}=e,d=[];if(t!=null&&t.isAccountCreatedRequired){const m=n.default.createElement(n.default.Fragment,null,"Have an account created before"," ",n.default.createElement("strong",null,new Date((t==null?void 0:t.accountCreated)||"").toLocaleDateString()));d.push(m)}if(t!=null&&t.isFollowRequired){const m=(b=t==null?void 0:t.follow)==null?void 0:b.split(","),S=n.default.createElement(n.default.Fragment,null,"Follow these account(s):",n.default.createElement("ul",null,m==null?void 0:m.map(E=>n.default.createElement("li",{key:E},n.default.createElement("a",{href:`https://twitter.com/${E.trim()}`,target:"_blank",rel:"noreferrer"},n.default.createElement("strong",null,"@",E))))));d.push(S)}if(t!=null&&t.isMinFollowersRequired){const m=n.default.createElement(n.default.Fragment,null,"Have at least ",n.default.createElement("b",null,t.minFollowers," follower(s)"));d.push(m)}if(t!=null&&t.isRetweetRequired){const m=n.default.createElement(n.default.Fragment,null,"Retweet"," ",n.default.createElement("a",{href:t.retweetUrl,target:"_blank",rel:"noreferrer"},n.default.createElement("strong",null,"this tweet")));d.push(m)}return d},[e]),a=async()=>{if(!(!l||!s||!(e!=null&&e.id)))try{u(!0);const{url:t}=await A({provider:"twitter",appId:l,walletAddress:s,chain:e.chain,projectId:e.id,returnUrl:window.location.href});window.location.assign(t)}catch(t){console.error(t)}finally{u(!1)}};return(c=e==null?void 0:e.twitter)!=null&&c.enabled?n.default.createElement(T,{title:"Twitter",onClick:a,info:f,rightText:(y=(h=e==null?void 0:e.userInfo)==null?void 0:h.twitter)==null?void 0:y.username,buttonDisabled:!s,isLoading:i}):null}const I={ethereum:"ETH",solana:"SOL",polygon:"MATIC",avalanche:"AVAX",flow:"FLOW"};function _({projectData:e}){const l=r.useMemo(()=>{if(!(e!=null&&e.wallet))return[];const{wallet:s}=e,i=[];if(s!=null&&s.isBalanceRequired){const u=n.default.createElement(n.default.Fragment,null,"Have at least",n.default.createElement("strong",null," "+s.balance+" "+I[e.chain]+" "),"in your wallet");i.push(u)}if(s!=null&&s.isNftRequired){const{nftCollection:u}=s,f=n.default.createElement(n.default.Fragment,null,"Hold an NFT from"," ",n.default.createElement("strong",null,n.default.createElement("a",{href:u==null?void 0:u.url,target:"_blank",rel:"noreferrer"},u==null?void 0:u.name)));i.push(f)}return i},[e]);return e!=null&&e.wallet?n.default.createElement(T,{title:"Wallet",onClick:()=>console.log("wallet button clicked"),info:l,rightText:" "}):null}const x="";function $({projectData:e,appId:l,walletAddress:s,inputRef:i}){var y;const[u,f]=r.useState(!1),[a,c]=r.useState(""),h=async()=>{var t,d;if(!(!l||!s||!(e!=null&&e.id)||((t=e==null?void 0:e.userInfo)==null?void 0:t.registered)))try{c(""),f(!0);const{error:g}=await L({appId:l,wallet:s,chain:e.chain,projectId:e.id,customField:((d=i==null?void 0:i.current)==null?void 0:d.value)||""});console.error("Register error",g),c(g.message)}catch(g){console.error(g)}finally{f(!1)}};return n.default.createElement(n.default.Fragment,null,n.default.createElement("button",{className:"hypeday-register-button",onClick:h,disabled:u},u&&n.default.createElement("div",{className:"hypeday-spinner hypeday-btn-spinner"}),n.default.createElement("span",{style:{visibility:u?"hidden":"initial"}},(y=e==null?void 0:e.userInfo)!=null&&y.registered?"Registered":"Register")),!!a&&n.default.createElement("span",{className:"hypeday-error"},a))}function U({appId:e,projectId:l,walletAddress:s}){const[i,u]=r.useState(),[f,a]=r.useState(!0),[c,h]=r.useState(!1),y=r.useRef(null),t=r.useCallback(async()=>{if(!l||!e){console.error("HypeDayReact: projectId and appId props are required.");return}a(!0),h(!1),k({appId:e,projectId:l,walletAddress:s}).then(d=>u(d)).catch(d=>{console.error("HypeDayReact: Error fetching project data",d),h(!0)}).finally(()=>a(!1))},[e,l,s]);return r.useEffect(()=>{t()},[t]),f?n.default.createElement("div",{className:"hypeday-wrapper",style:{display:"flex",justifyContent:"center"}},n.default.createElement("div",{className:"hypeday-spinner"})):c?n.default.createElement("div",{className:"hypeday-wrapper"},n.default.createElement("span",{className:"hypeday-error"},"Something went wrong. Please check your connection."),n.default.createElement("button",{className:"hypeday-button",onClick:t},"Retry")):n.default.createElement("div",{className:"hypeday-wrapper"},n.default.createElement(H,{projectData:i}),n.default.createElement(_,{projectData:i}),n.default.createElement(M,{projectData:i,appId:e,walletAddress:s}),n.default.createElement(O,{projectData:i,appId:e,walletAddress:s}),n.default.createElement(P,{projectData:i,ref:y}),n.default.createElement($,{projectData:i,appId:e,walletAddress:s,inputRef:y}))}return U});
