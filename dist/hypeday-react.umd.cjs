(function(r,R){typeof exports=="object"&&typeof module<"u"?module.exports=R(require("react")):typeof define=="function"&&define.amd?define(["react"],R):(r=typeof globalThis<"u"?globalThis:r||self,r.HypeDayReact=R(r.React))})(this,function(r){"use strict";const n=(e=>e&&typeof e=="object"&&"default"in e?e:{default:e})(r),k="https://apitest.hype.day";function q(e){return e.text().then(l=>{const s=l&&JSON.parse(l);if(!e.ok){const i=s&&s.message||e.statusText;return Promise.reject(i)}return s})}function C({appId:e,projectId:l,userId:s}){const i={method:"GET",headers:{"Content-Type":"application/json"}};return fetch(`${k}/getProject?`+new URLSearchParams({appid:e,userid:s||"",projectid:l}),i).then(q)}function T({provider:e,appId:l,projectId:s,userId:i,returnUrl:u}){const o={method:"GET",headers:{"Content-Type":"application/json"}};return fetch(`https://us-central1-hype-testing.cloudfunctions.net/${e==="twitter"?"t":"d"}GetUrlForApp?`+new URLSearchParams({appid:l,userid:i,projectid:s,returnurl:u}),o).then(q)}function A({title:e,rightText:l,buttonDisabled:s=!1,onClick:i,info:u,isLoading:o=!1}){return n.default.createElement("section",{className:"hypeday-section"},n.default.createElement("header",{className:"hypeday-section-header"},n.default.createElement("h3",{className:"hypeday-h3"},e),l?n.default.createElement("span",{className:"hypeday-info"},l):n.default.createElement("button",{className:"hypeday-button",onClick:i,disabled:o||s,title:s?"Please login first":void 0},o&&n.default.createElement("div",{className:"hypeday-spinner hypeday-btn-spinner"}),n.default.createElement("span",{style:{visibility:o?"hidden":"initial"}},"Connect"))),u.map((c,m)=>n.default.createElement("span",{key:m,className:"hypeday-info"},c)))}function L({projectData:e,appId:l,userId:s}){var m,h,y,t;const[i,u]=r.useState(!1),o=r.useMemo(()=>{var b,w;if(!((b=e==null?void 0:e.discord)!=null&&b.enabled)&&!((w=e==null?void 0:e.discord2)!=null&&w.enabled))return[];const{discord:f,discord2:E}=e,g=[];f!=null&&f.enabled&&g.push(f),E!=null&&E.enabled&&g.push(E);const d=[];return g.forEach(a=>{var S;if(a.isServerRequired){const N=n.default.createElement(n.default.Fragment,null,"Join the"," ",n.default.createElement("a",{href:a==null?void 0:a.serverLink,target:"_blank",rel:"noreferrer"},n.default.createElement("strong",null,a==null?void 0:a.serverDisplayName))," ","server on Discord",a.isShouldJoinBeforeRequired?n.default.createElement(n.default.Fragment,null," ","before"," ",n.default.createElement("strong",null,new Date((a==null?void 0:a.shouldJoinBefore)||"").toLocaleString())):null);d.push(N)}if(a.isRoleRequired){const N=n.default.createElement(n.default.Fragment,null,'and have the "',(S=a==null?void 0:a.roleDisplayNames)==null?void 0:S.join(", "),'" role(s)');d.push(N)}}),d},[e]),c=async()=>{if(!(!l||!s||!(e!=null&&e.id)))try{u(!0);const{url:f}=await T({provider:"discord",appId:l,userId:s,projectId:e.id,returnUrl:window.location.href});window.location.assign(f)}catch(f){console.error(f)}finally{u(!1)}};return!((m=e==null?void 0:e.discord)!=null&&m.enabled)&&!((h=e==null?void 0:e.discord2)!=null&&h.enabled)?null:n.default.createElement(A,{title:"Discord",onClick:c,info:o,rightText:(t=(y=e==null?void 0:e.userInfo)==null?void 0:y.discord)==null?void 0:t.username,buttonDisabled:!s,isLoading:i})}function H({projectData:e}){var s;if(!((s=e==null?void 0:e.customfield)!=null&&s.enabled))return null;const{customfield:l}=e;return n.default.createElement("section",{className:"hypeday-section"},n.default.createElement("header",{className:"hypeday-section-header"},n.default.createElement("h3",{className:"hypeday-h3"},"Open Response")),n.default.createElement("span",{className:"hypeday-info"},l.labels[0]),n.default.createElement("input",{className:"hypeday-input",type:"text",placeholder:l.labels[0]}))}function F({dateString:e,message:l}){const[s,i]=r.useState(!1),[u,o]=r.useState(0),[c,m]=r.useState(0),[h,y]=r.useState(0),[t,f]=r.useState(0);return r.useEffect(()=>{const E=new Date(e).getTime(),g=setInterval(()=>{const d=new Date().getTime(),b=E-d,w=Math.floor(b/(1e3*60*60*24)),a=Math.floor(b%(1e3*60*60*24)/(1e3*60*60)),S=Math.floor(b%(1e3*60*60)/(1e3*60)),N=Math.floor(b%(1e3*60)/1e3);if(b<=0){clearInterval(g),i(!0),o(0),m(0),y(0),f(0);return}o(w),m(a),y(S),f(N)},1e3);return()=>clearInterval(g)},[e]),!s&&!u&&!c&&!h&&!t?n.default.createElement("span",{style:{visibility:"hidden"}},"Calculating.."):s?n.default.createElement(n.default.Fragment,null,l):n.default.createElement(n.default.Fragment,null,u>0&&`${u} days, `,c>0&&`${c} hours, `,h>0&&`${h} minutes, `,t>0&&`${t} seconds`)}function v({children:e,title:l}){return n.default.createElement("section",{className:"hypeday-section"},n.default.createElement("header",{className:"hypeday-section-header"},n.default.createElement("h3",{className:"hypeday-h3"},l)),n.default.createElement("span",{className:"hypeday-info"},e))}function P({projectData:e}){var u,o,c,m,h,y,t,f,E,g,d,b;const[l,s]=r.useState(),i=((u=e==null?void 0:e.signupAccess)==null?void 0:u.isEndDateRequired)&&((o=e==null?void 0:e.signupAccess)==null?void 0:o.endDate)&&new Date((c=e==null?void 0:e.signupAccess)==null?void 0:c.endDate).getTime()<Date.now();return r.useEffect(()=>{var w,a,S,N;(w=e==null?void 0:e.signupAccess)!=null&&w.isStartDateRequired&&s(!!(((a=e==null?void 0:e.signupAccess)==null?void 0:a.isStartDateRequired)&&((S=e==null?void 0:e.signupAccess)==null?void 0:S.startDate)&&new Date((N=e==null?void 0:e.signupAccess)==null?void 0:N.startDate).getTime()>Date.now()))},[e]),r.useEffect(()=>{var w,a;if(l&&((w=e==null?void 0:e.signupAccess)==null?void 0:w.startDate)){const S=setTimeout(()=>s(!1),new Date((a=e==null?void 0:e.signupAccess)==null?void 0:a.startDate).getTime()-Date.now());return()=>clearTimeout(S)}},[l,(m=e==null?void 0:e.signupAccess)==null?void 0:m.startDate]),i&&((h=e.signupAccess)==null?void 0:h.endDate)?n.default.createElement(v,{title:"Registration is closed"},"Registration is closed on"," ",(t=new Date((y=e.signupAccess)==null?void 0:y.endDate))==null?void 0:t.toUTCString(),". Thank you for your interest."):l&&((f=e==null?void 0:e.signupAccess)==null?void 0:f.startDate)?n.default.createElement(v,{title:"Registration starts in:"},n.default.createElement(F,{dateString:(E=e==null?void 0:e.signupAccess)==null?void 0:E.startDate,message:"Registration is open."})):!i&&!l&&((g=e==null?void 0:e.signupAccess)==null?void 0:g.isEndDateRequired)&&((d=e==null?void 0:e.signupAccess)==null?void 0:d.endDate)?n.default.createElement(v,{title:"Registration ends in:"},n.default.createElement(F,{dateString:(b=e==null?void 0:e.signupAccess)==null?void 0:b.endDate,message:"Registration is closed."})):null}function M({projectData:e,appId:l,userId:s}){var m,h,y;const[i,u]=r.useState(!1),o=r.useMemo(()=>{var E,g;if(!((E=e==null?void 0:e.twitter)!=null&&E.enabled))return[];const{twitter:t}=e,f=[];if(t!=null&&t.isAccountCreatedRequired){const d=n.default.createElement(n.default.Fragment,null,"Have an account created before"," ",n.default.createElement("strong",null,new Date((t==null?void 0:t.accountCreated)||"").toLocaleDateString()));f.push(d)}if(t!=null&&t.isFollowRequired){const d=(g=t==null?void 0:t.follow)==null?void 0:g.split(","),b=n.default.createElement(n.default.Fragment,null,"Follow these account(s):",n.default.createElement("ul",null,d==null?void 0:d.map(w=>n.default.createElement("li",{key:w},n.default.createElement("a",{href:`https://twitter.com/${w.trim()}`,target:"_blank",rel:"noreferrer"},n.default.createElement("strong",null,"@",w))))));f.push(b)}if(t!=null&&t.isMinFollowersRequired){const d=n.default.createElement(n.default.Fragment,null,"Have at least ",n.default.createElement("b",null,t.minFollowers," follower(s)"));f.push(d)}if(t!=null&&t.isRetweetRequired){const d=n.default.createElement(n.default.Fragment,null,"Retweet"," ",n.default.createElement("a",{href:t.retweetUrl,target:"_blank",rel:"noreferrer"},n.default.createElement("strong",null,"this tweet")));f.push(d)}return f},[e]),c=async()=>{if(!(!l||!s||!(e!=null&&e.id)))try{u(!0);const{url:t}=await T({provider:"twitter",appId:l,userId:s,projectId:e.id,returnUrl:window.location.href});window.location.assign(t)}catch(t){console.error(t)}finally{u(!1)}};return(m=e==null?void 0:e.twitter)!=null&&m.enabled?n.default.createElement(A,{title:"Twitter",onClick:c,info:o,rightText:(y=(h=e==null?void 0:e.userInfo)==null?void 0:h.twitter)==null?void 0:y.username,buttonDisabled:!s,isLoading:i}):null}const U={ethereum:"ETH",solana:"SOL",polygon:"MATIC",avalanche:"AVAX",flow:"FLOW"};function _({projectData:e}){const l=r.useMemo(()=>{if(!(e!=null&&e.wallet))return[];const{wallet:s}=e,i=[];if(s!=null&&s.isBalanceRequired){const u=n.default.createElement(n.default.Fragment,null,"Have at least",n.default.createElement("strong",null," "+s.balance+" "+U[e.chain]+" "),"in your wallet");i.push(u)}if(s!=null&&s.isNftRequired){const{nftCollection:u}=s,o=n.default.createElement(n.default.Fragment,null,"Hold an NFT from"," ",n.default.createElement("strong",null,n.default.createElement("a",{href:u==null?void 0:u.url,target:"_blank",rel:"noreferrer"},u==null?void 0:u.name)));i.push(o)}return i},[e]);return e!=null&&e.wallet?n.default.createElement(A,{title:"Wallet",onClick:()=>console.log("wallet button clicked"),info:l,rightText:" "}):null}const x="";function O({appId:e,projectId:l,userId:s}){var g;const[i,u]=r.useState(),[o,c]=r.useState(!0),[m,h]=r.useState(!1),[y,t]=r.useState(!1),f=r.useCallback(async()=>{if(!l||!e){console.error("HypeDayReact: projectId and appId props are required.");return}c(!0),h(!1),C({appId:e,projectId:l,userId:s}).then(d=>u(d)).catch(d=>{console.error("HypeDayReact: Error fetching project data",d),h(!0)}).finally(()=>c(!1))},[e,l,s]);r.useEffect(()=>{f()},[f]);const E=()=>{var d;(d=i==null?void 0:i.userInfo)!=null&&d.registered||(t(!0),setTimeout(()=>t(!1),3e3),console.log("register button clicked"))};return o?n.default.createElement("div",{className:"hypeday-wrapper",style:{display:"flex",justifyContent:"center"}},n.default.createElement("div",{className:"hypeday-spinner"})):m?n.default.createElement("div",{className:"hypeday-wrapper"},n.default.createElement("span",{className:"hypeday-error"},"Something went wrong. Please check your connection."),n.default.createElement("button",{className:"hypeday-button",onClick:f},"Retry")):n.default.createElement("div",{className:"hypeday-wrapper"},n.default.createElement(P,{projectData:i}),n.default.createElement(_,{projectData:i}),n.default.createElement(M,{projectData:i,appId:e,userId:s}),n.default.createElement(L,{projectData:i,appId:e,userId:s}),n.default.createElement(H,{projectData:i}),n.default.createElement("button",{className:"hypeday-register-button",onClick:E,disabled:y},y&&n.default.createElement("div",{className:"hypeday-spinner hypeday-btn-spinner"}),n.default.createElement("span",{style:{visibility:y?"hidden":"initial"}},(g=i==null?void 0:i.userInfo)!=null&&g.registered?"Registered":"Register")))}return O});
